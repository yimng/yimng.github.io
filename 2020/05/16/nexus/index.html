<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png"><link rel="icon" type="image/png" href="/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content=""><meta name="author" content="Lukun"><meta name="keywords" content="python,python3,process,script,java,go,linux,"><title>nexus - Hello World!</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_fmb4a04yx8h.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css"><link rel="stylesheet" href="/css/main.css"><meta name="generator" content="Hexo 4.2.1"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/">&nbsp;<strong>Fluid</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> 归档</a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> 分类</a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i class="iconfont icon-search"></i>&nbsp;&nbsp;</a></li></ul></div></div></nav><div class="view intro-2" id="background" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="container text-center white-text fadeInUp"><span class="h2" id="subtitle"></span><div class="mt-3 post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-05-16 21:56">2020年5月16日 晚上</time></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 738 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 10 分钟</span></div></div></div></div></div></header><main><div class="container-fluid"><div class="row"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-md"><div class="container nopadding-md" id="board-ctn"><div class="py-5" id="board"><div class="post-content mx-auto" id="post"><article class="markdown-body"><h2 id="利用nexus3创建docker-registry"><a href="#利用nexus3创建docker-registry" class="headerlink" title="利用nexus3创建docker registry"></a>利用nexus3创建docker registry</h2><h3 id="1-用nexus3提供的镜像来启动个nexus3的容器"><a href="#1-用nexus3提供的镜像来启动个nexus3的容器" class="headerlink" title="1. 用nexus3提供的镜像来启动个nexus3的容器"></a>1. 用nexus3提供的镜像来启动个nexus3的容器</h3><ol><li><p>先创建个nexus使用的卷：<br><code>docker volume create --name nexus-data</code></p></li><li><p>然后启动nexus容器，注意要加下8443，8444，8445端口，以后docker 拉推镜像会用到8444，8445端口，8443是https用的</p><pre><code class="hljs plain">docker run -d -p 8081:8081 -p 8443:8443 -p 8444:8444 -p 8445:8445 -v &#x2F;etc&#x2F;localtime:&#x2F;etc&#x2F;localtime -v nexus-data:nexus:data  --name nexus sonatype&#x2F;nexus3</code></pre></li></ol><ol start="3"><li>然后等待nexus容器起来，会有一会的延迟，然后访问http:ip:8081,点击登录，会弹出登录的按钮，默认密码在容器内，可用下面命令找到：<br>先进入容器<br><code>docker exec -it container-id /bin/bash</code><br>然后<br><code>cat /nexus-data/admin-password</code>，把密码拷贝出来去登录，第一次会让你设置个自己的密码。</li></ol><h3 id="2-配置nexus3-使用-https"><a href="#2-配置nexus3-使用-https" class="headerlink" title="2. 配置nexus3 使用 https"></a>2. 配置nexus3 使用 https</h3><p>参见<a href="https://support.sonatype.com/hc/en-us/articles/217542177" target="_blank" rel="noopener">https://support.sonatype.com/hc/en-us/articles/217542177</a>这篇文章<br>具体步骤：</p><ol><li><p>登录到nexus容器内：<br><code>docker exec -it nexus-container-id /bin/bash</code></p></li><li><p>在$data-dir/etc/ssl/keystore.jks创建java keystore 文件, $data-dir/为/nexus-data目录，其中，把${NEXUS_DOMAIN} 替换成nexus的域名，${NEXUS_IP_ADDRESS}替换成nexus的ip</p><pre><code class="hljs plain">keytool -genkeypair -keystore keystore.jks -storepass password -keypass password -alias jetty -keyalg RSA -keysize 2048 -validity 5000 -dname &quot;CN&#x3D;*.$&#123;NEXUS_DOMAIN&#125;, OU&#x3D;Example, O&#x3D;Sonatype, L&#x3D;Unspecified, ST&#x3D;Unspecified, C&#x3D;US&quot; -ext &quot;SAN&#x3D;DNS:$&#123;NEXUS_DOMAIN&#125;,IP:$&#123;NEXUS_IP_ADDRESS&#125;&quot; -ext &quot;BC&#x3D;ca:true&quot;</code></pre></li></ol><ol start="3"><li><p>编辑$data-dir/etc/nexus.properties文件，增加一行<br><code>application-port-ssl=8443</code><br>8443是https用的端口，可以改为其它端口。<br>把包含nexus-args的一行开头注释去掉，然后在逗号分隔的那些值里加入${jetty.etc}/jetty-https.xml<br>修改后的那一行应该是这个样子：</p><pre><code class="hljs plain">nexus-args&#x3D;$&#123;jetty.etc&#125;&#x2F;jetty.xml,$&#123;jetty.etc&#125;&#x2F;jetty-http.xml,$&#123;jetty.etc&#125;&#x2F;jetty-https.xml,$&#123;jetty.etc&#125;&#x2F;jetty-requestlog.xml</code></pre></li></ol><ol start="4"><li><p>(可选)如果你不想用http connector，可以把${jetty.etc}/jetty-http.xml去掉</p></li><li><p>增加一行:<br><code>ssl.etc=${karaf.data}/etc/ssl</code></p></li><li><p>编辑 $install-dir/etc/jetty/jetty-https.xml<br>正确设置 keystore 的密码，如果你用password作为密码，这一步就不是必须的了<br>(建议)<br>在包含&lt;Set name=KeyStorePath”&gt;的这一行前面加上下面一行，例如如果你的PrivateKeyEntry 叫jetty, 增加下面一行：<br><code>&lt;Set name=&quot;certAlias&quot;&gt;jetty&lt;/Set&gt;</code></p></li><li><p>重启nexus容器</p></li></ol><h3 id="3-配置docker-repository"><a href="#3-配置docker-repository" class="headerlink" title="3. 配置docker repository"></a>3. 配置docker repository</h3><p>配置docker repository，添加proxy, hosted, group 类型的docker repository, 其中 hosted,和group类型的用https, 端口用8445，8444</p><h3 id="4-在docker-客户端配置nexus使用的自签名的ca"><a href="#4-在docker-客户端配置nexus使用的自签名的ca" class="headerlink" title="4. 在docker 客户端配置nexus使用的自签名的ca"></a>4. 在docker 客户端配置nexus使用的自签名的ca</h3><p>如果是centos:</p><pre><code class="hljs plain">openssl s_client -showcerts -connect nexus-ip:8443 &lt;&#x2F;dev&#x2F;null 2&gt;&#x2F;dev&#x2F;null | openssl x509 -outform PEM &gt; &#x2F;etc&#x2F;pki&#x2F;ca-trust&#x2F;source&#x2F;anchors&#x2F;nexus-ip.crt
update-ca-trust</code></pre><p>如果是在ubuntu:</p><pre><code class="hljs plain">openssl s_client -showcerts -connect nexus-ip:8443 &lt;&#x2F;dev&#x2F;null 2&gt;&#x2F;dev&#x2F;null | openssl x509 -outform PEM &gt; &#x2F;usr&#x2F;local&#x2F;share&#x2F;ca-certificates&#x2F;nexus-ip.crt
update-ca-certificates</code></pre><h3 id="5-docker-login-nexus-ip-8445"><a href="#5-docker-login-nexus-ip-8445" class="headerlink" title="5. docker login nexus-ip:8445"></a>5. docker login nexus-ip:8445</h3><p>用户名密码为登录nexus的admin和相应的密码<br>如果push 或者pull的时候，出现no basic auth的错误，修改~/.docker/config里相应的端口号</p></article><hr><div><div class="post-metas mb-3"></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p><div class="post-prevnext row"><div class="post-prev col-6"><a href="/2020/05/16/hello-world/"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Hello World</span> <span class="visible-mobile">上一篇</span></a></div><div class="post-next col-6"><a href="/2020/05/16/test/"><span class="hidden-mobile">test</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></div></div></div><div class="comments" id="comments"></div></div></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div id="tocbot"></div></div></div></div></div></main><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div><footer class="mt-5"><div class="text-center py-3"><div><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></div></footer><script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script><script src="/js/main.js"></script><script src="/js/lazyload.js"></script><script src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js"></script><script>$(document).ready(function(){var t=$("#board-ctn").offset().top;tocbot.init({tocSelector:"#tocbot",contentSelector:".post-content",headingSelector:"h1,h2,h3,h4,h5,h6",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",collapseDepth:0,scrollSmooth:!0,headingsOffset:-t}),0<$(".toc-list-item").length&&$("#toc").css("visibility","visible")})</script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script src="/js/clipboard-use.js"></script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>var typed=new Typed("#subtitle",{strings:["  ","nexus&nbsp;"],cursorChar:"_",typeSpeed:70,loop:!1});typed.stop(),$(document).ready(function(){$(".typed-cursor").addClass("h2"),typed.start()})</script><script src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js"></script><script>anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))</script><script src="/js/local-search.js"></script><script>var path="/local-search.xml",inputArea=document.querySelector("#local-search-input");inputArea.onclick=function(){searchFunc(path,"local-search-input","local-search-result"),this.onclick=null}</script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><script>$("#post img:not(.no-zoom img, img[no-zoom]), img[zoom]").each(function(){var t=document.createElement("a");$(t).attr("data-fancybox","images"),$(t).attr("href",$(this).attr("src")),$(this).wrap(t)})</script></body></html>